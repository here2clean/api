---
- hosts: all
  remote_user: ubuntu
  vars:
    ansible_host_key_checking: false
  roles:
    - including_vars

  tasks: 
    - name: Install add-apt-repostory
      become: yes
      apt: name=software-properties-common state=latest

    - name: Add Openjdk repo
      become: yes
      apt_repository: repo='ppa:openjdk-r/ppa'
    
    - name: Put db password env
      become: yes
      shell: export DATABASE_PASSWORD={{lookup('file', '/home/dbpwd') }}
    
    - name: Put db adress url
      become: yes
      shell: export DATABASE_URL={{lookup('file', 'mysql_url.txt') }}

    - name: Install openjdk 8 p1
      become: yes
      apt: name=openjdk-8-jre
    
    - name: echo
      become: yes
      shell: java -version
    
    - name: Copy using inline content
      become: yes
      copy:
        content: ../target/heretoclean-0.0.1-SNAPSHOT.jar
        dest: /home/heretoclean-0.0.1-SNAPSHOT.jar
    
    - name: run
      become: yes
      shell: cd /home/ && nohup java -jar heretoclean-0.0.1-SNAPSHOT.jar &
